# Kafka configuration for learning environment
# Bitnami Kafka Helm chart values

kafka:
  # Specific image tag - using bitnamilegacy as bitnami/kafka main repo is missing versions
  image:
    registry: docker.io
    repository: bitnamilegacy/kafka
    tag: 3.7.1-debian-12-r11

  # Single replica for dev/learning
  controller:
    replicaCount: 1
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    persistence:
      enabled: true
      size: 8Gi

  # Broker settings (KRaft mode - no ZooKeeper needed)
  broker:
    replicaCount: 0  # Using combined mode

  # Listeners
  listeners:
    client:
      protocol: PLAINTEXT
      containerPort: 9092
    controller:
      protocol: PLAINTEXT
    interbroker:
      protocol: PLAINTEXT

  # Service - LoadBalancer for external access
  service:
    type: LoadBalancer
    ports:
      client: 9092

  # Metrics for Prometheus
  metrics:
    kafka:
      enabled: true
      image:
        registry: docker.io
        repository: danielqsj/kafka-exporter
        tag: v1.7.0
      # Override default command which requires bash
      command: ["/bin/kafka_exporter"]
      # Ensure args are passed correctly if needed, but chart usually appends them
    jmx:
      enabled: false

  # Settings
  logRetentionHours: 168
  autoCreateTopicsEnable: true

  podAnnotations:
    gitops-managed: "true"

# Kafka UI configuration
kafka-ui:
  envs:
    config:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:9092

  service:
    type: LoadBalancer
    port: 80
